---
name: agentica.init
description: Инициализация нового проекта с базовой структурой и шаблонами
---

## Ввод пользователя

```text
$ARGUMENTS
```

Ты **ОБЯЗАН** учесть ввод пользователя (аргументы и контекст) перед тем как продолжить.

## Цель и принципы работы

Твоя задача — привести проект к рабочему состоянию Agentica.
Работай строго линейно: **Диагностика → Выбор сценария → Реализация → Проверка → Отчёт**.

### Глобальные запреты (Safety Guards)

Останови выполнение и не вноси изменения, если:
1. Запрос требует другого пайплайна (tasks, implement, refactor, readme, commit, release), а не инициализации/настройки.
2. Пользователь просит изменить узкую реализацию, несвязанную с настройкой Agentica.
3. Входные данные противоречивы.
4. Проект **уже инициализирован** (есть `.agentica/` и ключевые файлы), и пользователь не выбрал явный режим обновления.

В случае остановки: объясни причину и предложи корректную команду.

## 1. Топология и размещение файлов

Все артефакты **строго** находятся внутри директории `.agentica/`. Вне её ничего создавать нельзя.

### Группы артефактов
1. **[Context]:** `product.md`, `structure.md`, `tech.md`, `status.md`. (Обязательны для любого активного скоупа).
2. **[Config]:** Директории `prompts/`, `templates/`. (Только в корне проекта/репозитория).
3. **[Specs]:** Директории `architecture/`, `changes/`, `features/`, `release/`. (Только там, где лежит код/пакет).

### Матрица размещения

| Тип проекта | Локация (Scope) | Состав артефактов |
| :--- | :--- | :--- |
| **Single-project** | Корень (`./.agentica/`) | **[Context]** + **[Config]** + **[Specs]** |
| **Monorepo** | Корень репо (`./.agentica/`) | **[Context]** + **[Config]**. **ЗАПРЕЩЕНО** создавать [Specs] здесь. |
| **Monorepo** | Пакет (`./packages/X/.agentica/`) | **[Context]** + **[Specs]**. |

## 2. Диагностика и Выбор сценария

Проанализируй файловую систему и аргументы:
1. **Тип проекта:** Single-project или Monorepo.
2. **Состояние:** Пустая папка (Empty) или есть код (Existing).
3. **Наличие Agentica:** Инициализирован или нет.

Если данных критически не хватает — задай вопрос через интсрумент `ask_questions` (максимум 1-3 вопроса с вариантами ответа).

### Сценарии (приоритет: A/B → C → D)

#### Сценарий A: "Empty Init" (Новый проект с нуля)
*Условие:* Директория пуста.
1. Создай структуру согласно матрице размещения.
2. Заполни **[Context]** шаблонами (цели, границы, стек по умолчанию).
3. Создай **[Config]** и **[Specs]**.
4. Запиши статус: `проект создан`.

#### Сценарий B: "Existing Project" (Интеграция)
*Условие:* Есть код, но нет Agentica.
1. Не ломай существующую структуру.
2. Создай структуру Agentica согласно матрице (Single или Mono/Package).
3. Заполни **[Context]** на основе **реального** анализа кода, а не шаблонами.
4. Адаптируй промпты в **[Config]** под текущие инструменты (линтеры, тесты).
5. Запиши статус: `интеграция завершена успешно`.

#### Сценарий C: "Docs Update" (Обновление документов)
*Условие:* Agentica есть, пользователь просит обновить контекст.
1. Проверь согласованность **[Context]** (product/structure/tech).
2. Устрани противоречия, добавь недостающие, но реально нужные разделы.
3. Статус: `обновление документации`.

#### Сценарий D: "Post Tuning" (Пост-настройка промптов и шаблонов Agentica)
*Условие:* Проект уже инициализирован, и пользователь хочет обновить стек, инструменты или правила работы.
1. Определи целевой scope изменений: только root `.agentica/`, только пакет(ы) или оба уровня.
2. Сверь актуальный стек по `tech.md`, `package.json`, конфигам линтера/тестов/сборки и фактическим командам проекта.
3. Зафиксируй карту миграции инструментов (что заменить и на что):
  - команды запуска/сборки;
  - команды тестирования и линтинга;
  - команды рефакторинга и проверки качества.
4. Обнови **[Context]** (`product.md`, `structure.md`, `tech.md`) в релевантных scope так, чтобы они отражали новый стек и ограничения.
5. Обнови **[Config]** в root `.agentica/`:
  - синхронизируй все файлы в `.agentica/prompts/` с новым набором инструментов;
  - обязательно проверь `refactor.prompt.md` и `validate.prompt.md` на конкретные команды;
  - обязательно адаптируй `release.prompt.md` под стек и реальные команды релизного пайплайна;
  - выполни семантический поиск по запуску инструментов и regex-поиск упоминаний legacy-команд (`bun`, `tsc` и т.п.), затем замени их на актуальные.
6. Обнови шаблоны в `.agentica/templates/`, чтобы формулировки по сборке, тестам, линтингу и валидации соответствовали реальному техстеку.
7. Проверь консистентность: одинаковые команды и правила должны использоваться в `tech.md`, промптах и шаблонах без противоречий.
8. Статус: `Текущий статус интеграции: Шаблоны и промпты адаптированы под технологический стек проекта`.

*Если проект уже инициализирован, но пользователь не уточнил задачу:*
1. Зафиксируй наличие инициализации.
2. Через интсрумент `ask_questions` предложи: обновить доки (C), подогнать промпты (D) или выполнить синхронизацию.

## 3. Требования к качеству (Quality Gate)

1. **[Context] файлы:** Должны отражать реальность, не содержать "воды" и пустых заглушек.
2. **Status файл (`status.md`):**
  - Всегда обновляй в конце работы.
  - Допустимые форматы:
    - `Текущий статус интеграции: интеграция завершена успешно`
    - `Текущий статус интеграции: интеграция в процессе по сценарию <N>`
  - Для обновлений (C/D) — дописывай историю изменений вниз, не стирая заголовок.

## 4. Финальная проверка

Перед выдачей ответа проверь:
1. Все файлы из групп **[Context]**, **[Config]**, **[Specs]** существуют на своих местах согласно матрице размещения.
2. В корне Monorepo **нет** папок `architecture`, `changes`, `features`, `release`.
3. В `status.md` записан актуальный статус.
4. Файлы `product/structure/tech` не противоречат друг другу.

## 5. Формат отчёта

Выдай пользователю короткое резюме:
1. Выполненный сценарий.
2. Список созданных/обновленных файлов.
3. Текущий статус из `status.md`.
4. Что осталось сделать вручную (если есть).